/* ============================================
   MHSA Visualizer - Main Stylesheet
   ============================================ */

/* === Base Reset & Typography === */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

/* === Layout === */
.container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    overflow: hidden;
}

header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
}

.subtitle {
    font-size: 1.1em;
    opacity: 0.9;
}

.content {
    padding: 25px;
}

/* === Controls === */
.controls {
    padding: 25px;
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.control-group {
    margin-bottom: 20px;
}

label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #495057;
}

input[type="text"],
input[type="number"],
select {
    width: 100%;
    padding: 10px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.3s;
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus {
    outline: none;
    border-color: #667eea;
}

.control-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

/* === Buttons === */
button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

button:active {
    transform: translateY(0);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: #6c757d;
}

.btn-secondary:hover {
    background: #5a6268;
}

/* === Sections === */
.section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.section-title {
    font-size: 1.5em;
    margin-bottom: 15px;
    color: #495057;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title::before {
    content: '';
    width: 8px;
    height: 8px;
    background: #667eea;
    border-radius: 50%;
}

/* === Cards & Boxes === */
.viz-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.viz-card h3 {
    margin-bottom: 12px;
    color: #495057;
    font-size: 1.1em;
}

.info-box {
    background: #e7f3ff;
    border-left: 4px solid #2196F3;
    padding: 15px;
    margin: 15px 0;
    border-radius: 4px;
}

.info-box strong {
    color: #1976D2;
}

/* === Token Display === */
.token-display {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 15px 0;
}

.token {
    background: white;
    padding: 8px 16px;
    border-radius: 20px;
    border: 2px solid #667eea;
    font-weight: 600;
    color: #667eea;
}

/* === Tabs === */
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    border-bottom: 2px solid #dee2e6;
}

.tab {
    padding: 10px 20px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 600;
    color: #6c757d;
    transition: all 0.3s;
}

.tab.active {
    color: #667eea;
    border-bottom-color: #667eea;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* === Canvas === */
canvas {
    display: block;
    width: 100%;
    border-radius: 4px;
    border: 1px solid #dee2e6;
}

/* === Matrix Display === */
.matrix-display {
    font-family: 'Courier New', monospace;
    background: white;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 12px;
    line-height: 1.6;
}

.matrix-row {
    white-space: nowrap;
}

.matrix-value {
    display: inline-block;
    min-width: 60px;
    text-align: right;
    padding: 2px 4px;
}

/* === Attention Grid === */
.attention-grid {
    display: grid;
    gap: 2px;
    margin: 15px 0;
}

.attention-cell {
    padding: 8px;
    text-align: center;
    font-size: 11px;
    border-radius: 2px;
    color: white;
    font-weight: 600;
}

/* === Head Container === */
.head-container {
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.head-title {
    font-weight: 700;
    color: #667eea;
    margin-bottom: 12px;
    font-size: 1.1em;
}

/* === Math Steps === */
.math-step {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 6px;
    border-left: 3px solid #667eea;
}

.math-step h4 {
    color: #667eea;
    margin-bottom: 8px;
}

.formula {
    font-family: 'Courier New', monospace;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 4px;
    margin: 8px 0;
    overflow-x: auto;
}

.formula-box {
    background: #fffbf0;
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin: 15px 0;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
}

/* === Flow Diagram === */
.flow-diagram {
    display: flex;
    align-items: center;
    justify-content: space-around;
    margin: 20px 0;
    padding: 20px;
    background: white;
    border-radius: 8px;
    overflow-x: auto;
}

.flow-step {
    text-align: center;
    padding: 15px;
    min-width: 120px;
}

.flow-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    font-weight: 600;
    margin-bottom: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.flow-arrow {
    font-size: 2em;
    color: #667eea;
    margin: 0 10px;
}

/* === Q/K/V Cards === */
.qkv-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.qkv-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.qkv-card h3 {
    margin-bottom: 15px;
    color: #495057;
}

.qkv-query { border-left: 4px solid #FF6B6B; }
.qkv-key { border-left: 4px solid #4ECDC4; }
.qkv-value { border-left: 4px solid #95E1D3; }

.vector-display {
    font-family: 'Courier New', monospace;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 4px;
    font-size: 11px;
    margin: 8px 0;
    overflow-x: auto;
    max-height: 150px;
    overflow-y: auto;
}

.vector-row {
    margin: 4px 0;
}

/* === Meaning Box === */
.meaning-box {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin: 15px 0;
}

.meaning-box h4 {
    margin-bottom: 10px;
}

/* === Highlights === */
.highlight-query {
    background: rgba(255, 107, 107, 0.3);
    padding: 2px 4px;
    border-radius: 3px;
}

.highlight-key {
    background: rgba(78, 205, 196, 0.3);
    padding: 2px 4px;
    border-radius: 3px;
}

.highlight-value {
    background: rgba(149, 225, 211, 0.3);
    padding: 2px 4px;
    border-radius: 3px;
}

/* === Token Embedding Visualization === */
.token-embedding-viz {
    display: flex;
    align-items: center;
    margin: 15px 0;
    background: white;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
}

.token-box {
    background: #667eea;
    color: white;
    padding: 10px 15px;
    border-radius: 6px;
    font-weight: 600;
    min-width: 80px;
    text-align: center;
}

.embedding-viz {
    display: flex;
    gap: 2px;
    margin: 0 15px;
}

.embedding-bar {
    width: 8px;
    background: linear-gradient(to top, #667eea, #764ba2);
    border-radius: 2px;
}

.projection-arrow {
    margin: 0 10px;
    font-size: 1.5em;
    color: #667eea;
}

/* === Sequence Visualization === */
.sequence-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin: 20px 0;
    padding: 20px;
    background: white;
    border-radius: 8px;
}

.seq-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.seq-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.seq-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.seq-btn-secondary {
    background: #6c757d;
    color: white;
    padding: 10px 25px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.seq-btn-secondary:hover {
    background: #5a6268;
}

.step-indicator {
    font-size: 18px;
    font-weight: 700;
    color: #667eea;
    min-width: 150px;
    text-align: center;
}

.step-progress {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
    margin: 10px 0 30px 0;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.4s ease;
    width: 11.11%;
}

.sequence-visualization {
    background: white;
    border-radius: 8px;
    padding: 30px;
    min-height: 500px;
    margin: 20px 0;
}

.step-content {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.step-title {
    font-size: 24px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.step-number {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
}

.step-description {
    font-size: 16px;
    line-height: 1.8;
    color: #495057;
    margin-bottom: 20px;
}

/* === Dimension Tracker === */
.dimension-tracker {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #fff;
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    font-family: 'Courier New', monospace;
}

.dimension-tracker h4 {
    color: #00d4ff;
    margin-bottom: 15px;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.dim-row {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 12px 0;
    flex-wrap: wrap;
}

.dim-badge {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 8px 14px;
    border-radius: 6px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.dim-badge.embedding { border-color: #a8edea; }
.dim-badge.query { border-color: #FF6B6B; }
.dim-badge.key { border-color: #4ECDC4; }
.dim-badge.value { border-color: #95E1D3; }
.dim-badge.scores { border-color: #ffc107; }
.dim-badge.attention { border-color: #667eea; }
.dim-badge.output { border-color: #84fab0; }

.dim-label {
    font-size: 11px;
    opacity: 0.7;
}

.dim-shape {
    font-weight: 700;
    font-size: 13px;
}

.dim-operator {
    font-size: 18px;
    color: #667eea;
    font-weight: 700;
}

/* === Matrix Shape Display === */
.matrix-shape-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 25px;
    background: white;
    border-radius: 12px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.matrix-block {
    text-align: center;
    position: relative;
}

.matrix-rect {
    border: 3px solid #667eea;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
    position: relative;
    background: rgba(102, 126, 234, 0.05);
}

.matrix-rect.small { width: 50px; height: 70px; }
.matrix-rect.medium { width: 60px; height: 80px; }
.matrix-rect.square { width: 70px; height: 70px; }
.matrix-rect.wide { width: 90px; height: 70px; }

.matrix-rect.embedding { border-color: #a8edea; background: rgba(168, 237, 234, 0.1); }
.matrix-rect.query { border-color: #FF6B6B; background: rgba(255, 107, 107, 0.1); }
.matrix-rect.key { border-color: #4ECDC4; background: rgba(78, 205, 196, 0.1); }
.matrix-rect.value { border-color: #95E1D3; background: rgba(149, 225, 211, 0.1); }
.matrix-rect.scores { border-color: #ffc107; background: rgba(255, 193, 7, 0.1); }
.matrix-rect.attention { border-color: #667eea; background: rgba(102, 126, 234, 0.1); }
.matrix-rect.output { border-color: #84fab0; background: rgba(132, 250, 176, 0.1); }

.matrix-dim-label {
    position: absolute;
    font-size: 10px;
    font-weight: 600;
    color: #666;
}

.matrix-dim-label.top { top: -18px; left: 50%; transform: translateX(-50%); }
.matrix-dim-label.left { left: -25px; top: 50%; transform: translateY(-50%) rotate(-90deg); }
.matrix-dim-label.bottom { bottom: -18px; left: 50%; transform: translateX(-50%); }
.matrix-dim-label.right { right: -25px; top: 50%; transform: translateY(-50%) rotate(90deg); }

.matrix-name {
    margin-top: 10px;
    font-weight: 700;
    font-size: 14px;
    color: #495057;
}

.matrix-dims {
    font-size: 11px;
    color: #6c757d;
    margin-top: 4px;
}

.op-symbol {
    font-size: 32px;
    font-weight: 700;
    color: #667eea;
}

.equals-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #667eea;
}

.equals-arrow .arrow { font-size: 28px; }
.equals-arrow .text { font-size: 11px; font-weight: 600; }

/* === Step Summary === */
.step-summary {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-left: 5px solid #667eea;
    padding: 20px;
    border-radius: 0 12px 12px 0;
    margin: 25px 0;
}

.step-summary h4 {
    color: #667eea;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.step-summary ul {
    margin: 0;
    padding-left: 20px;
    line-height: 1.8;
}

.step-summary li {
    color: #495057;
}

/* === What's Happening Box === */
.whats-happening {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 12px;
    margin: 25px 0;
}

.whats-happening h4 {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 16px;
}

.whats-happening p {
    opacity: 0.95;
    line-height: 1.7;
    margin: 0;
}

/* === Result Box === */
.result-box {
    background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    color: #1a1a1a;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    font-weight: 600;
    text-align: center;
}

/* === Computation Visual === */
.computation-visual {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.data-flow {
    display: flex;
    align-items: center;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 20px;
    margin: 20px 0;
}

.data-box {
    background: white;
    border: 3px solid #667eea;
    border-radius: 8px;
    padding: 15px 20px;
    min-width: 120px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s;
}

.data-box.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: scale(1.05);
    box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
}

.data-label {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    opacity: 0.7;
    margin-bottom: 5px;
}

.data-value {
    font-size: 18px;
    font-weight: 700;
}

.operation-symbol {
    font-size: 36px;
    color: #667eea;
    font-weight: 700;
}

/* === Matrix Visual Box === */
.matrix-visual-box {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    position: relative;
}

.matrix-visual-box[data-label]::before {
    content: attr(data-label);
    position: absolute;
    top: -12px;
    left: 20px;
    background: white;
    padding: 0 10px;
    font-size: 13px;
    font-weight: 600;
    color: #667eea;
}

/* === Step Navigator === */
.step-navigator {
    margin-top: 30px;
}

.nav-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}

.nav-step {
    background: #f8f9fa;
    border: 2px solid #dee2e6;
    padding: 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.nav-step:hover {
    border-color: #667eea;
    background: #e7f3ff;
}

.nav-step.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
}

.nav-step-num {
    font-weight: 700;
    font-size: 12px;
    margin-bottom: 5px;
}

.nav-step-name {
    font-size: 11px;
}

/* === Transformer Architecture === */
.transformer-architecture {
    background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
    border-radius: 16px;
    padding: 30px;
    margin: 20px 0;
    position: relative;
    overflow: hidden;
}

.transformer-architecture::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
    pointer-events: none;
}

.arch-title {
    color: #00d4ff;
    font-size: 1.4em;
    font-weight: 700;
    text-align: center;
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.transformer-stack {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    position: relative;
}

.transformer-layer {
    width: 100%;
    max-width: 800px;
    position: relative;
}

.layer-wrapper {
    background: rgba(255, 255, 255, 0.03);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    margin: 8px 0;
    position: relative;
    transition: all 0.3s ease;
}

.layer-wrapper:hover {
    border-color: rgba(102, 126, 234, 0.5);
    background: rgba(255, 255, 255, 0.05);
}

.layer-wrapper.highlighted {
    border-color: #00d4ff;
    box-shadow: 0 0 30px rgba(0, 212, 255, 0.3), inset 0 0 30px rgba(0, 212, 255, 0.05);
}

.layer-label {
    position: absolute;
    top: -12px;
    left: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 4px 14px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.layer-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

.arch-component {
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    padding: 15px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
}

.arch-component:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.arch-component.mha {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
    border-color: #667eea;
}

.arch-component.mha:hover, .arch-component.mha.active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5));
    box-shadow: 0 0 30px rgba(102, 126, 234, 0.4);
}

.arch-component.ffn {
    background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(68, 160, 141, 0.2));
    border-color: #4ECDC4;
}

.arch-component.norm {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
    border-color: #ffc107;
    min-width: 80px;
    padding: 8px 15px;
}

.arch-component.residual {
    background: transparent;
    border: 2px dashed rgba(132, 250, 176, 0.5);
    min-width: auto;
    padding: 8px;
}

.component-icon {
    font-size: 24px;
    margin-bottom: 8px;
}

.component-name {
    color: #fff;
    font-weight: 600;
    font-size: 13px;
    margin-bottom: 4px;
}

.component-detail {
    color: rgba(255, 255, 255, 0.6);
    font-size: 10px;
}

.arch-arrow {
    color: rgba(255, 255, 255, 0.4);
    font-size: 24px;
    font-weight: 300;
}

.arch-arrow.vertical {
    display: block;
    text-align: center;
    margin: 5px 0;
}

/* === Multi-Head Detail View === */
.mha-detail-container {
    margin-top: 25px;
    padding-top: 25px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.mha-detail-title {
    color: #00d4ff;
    font-size: 1.1em;
    font-weight: 600;
    text-align: center;
    margin-bottom: 20px;
}

.heads-parallel-view {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    margin: 20px 0;
}

.head-unit {
    background: linear-gradient(180deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
    border: 2px solid rgba(102, 126, 234, 0.4);
    border-radius: 10px;
    padding: 15px;
    min-width: 100px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.head-unit:hover, .head-unit.active {
    border-color: #00d4ff;
    background: linear-gradient(180deg, rgba(102, 126, 234, 0.4) 0%, rgba(118, 75, 162, 0.4) 100%);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
}

.head-unit::after {
    content: '';
    position: absolute;
    bottom: -15px;
    left: 50%;
    width: 2px;
    height: 15px;
    background: linear-gradient(to bottom, rgba(102, 126, 234, 0.5), transparent);
}

.head-number {
    color: #00d4ff;
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 8px;
}

.head-qkv {
    display: flex;
    gap: 4px;
    justify-content: center;
    margin-bottom: 8px;
}

.head-qkv-item {
    width: 22px;
    height: 22px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    color: white;
}

.head-qkv-item.q { background: #FF6B6B; }
.head-qkv-item.k { background: #4ECDC4; }
.head-qkv-item.v { background: #95E1D3; }

.head-dim {
    color: rgba(255, 255, 255, 0.5);
    font-size: 9px;
}

.concat-bar {
    background: linear-gradient(90deg, 
        #FF6B6B 0%, #FF6B6B 20%, 
        #4ECDC4 20%, #4ECDC4 40%, 
        #95E1D3 40%, #95E1D3 60%,
        #F7DC6F 60%, #F7DC6F 80%,
        #DDA0DD 80%, #DDA0DD 100%);
    height: 20px;
    border-radius: 10px;
    max-width: 500px;
    margin: 20px auto;
    position: relative;
    overflow: hidden;
}

.concat-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 11px;
    text-align: center;
    margin-top: 8px;
}

/* === Data Flow Visualization === */
.data-flow-viz {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    margin: 20px 0;
    overflow-x: auto;
}

.flow-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.flow-node-box {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    padding: 12px 18px;
    color: white;
    font-weight: 600;
    font-size: 12px;
    white-space: nowrap;
}

.flow-node-box.input { border-color: #a8edea; color: #a8edea; }
.flow-node-box.qkv-proj { border-color: #667eea; color: #667eea; }
.flow-node-box.attention { border-color: #ffc107; color: #ffc107; }
.flow-node-box.output { border-color: #84fab0; color: #84fab0; }

.flow-connector {
    color: rgba(255, 255, 255, 0.4);
    font-size: 18px;
}

.flow-dim {
    color: rgba(255, 255, 255, 0.5);
    font-size: 10px;
}

/* === Architecture Info Panel === */
.arch-info-panel {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    border-left: 4px solid #00d4ff;
}

.arch-info-panel h4 {
    color: #00d4ff;
    margin-bottom: 12px;
    font-size: 14px;
}

.arch-info-panel p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    line-height: 1.7;
    margin: 0;
}

.arch-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-top: 20px;
}

.arch-stat {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
}

.arch-stat-value {
    color: #00d4ff;
    font-size: 20px;
    font-weight: 700;
}

.arch-stat-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 11px;
    margin-top: 4px;
}

/* === Layer Repeat Indicator === */
.layer-repeat-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: rgba(255, 255, 255, 0.5);
    font-size: 12px;
    margin: 15px 0;
    padding: 10px;
    border: 1px dashed rgba(255, 255, 255, 0.2);
    border-radius: 8px;
}

.layer-repeat-indicator strong {
    color: #00d4ff;
}

/* === Architecture View Toggle === */
.arch-view-toggle {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.arch-toggle-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.6);
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s;
}

.arch-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white;
}

.arch-toggle-btn.active {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-color: #667eea;
    color: white;
}

/* === Animations === */
.connection-pulse {
    animation: pulseFlow 2s ease-in-out infinite;
}

@keyframes pulseFlow {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
}

@keyframes highlightPulse {
    0%, 100% { box-shadow: 0 0 5px rgba(102, 126, 234, 0.3); }
    50% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.6); }
}

.highlight-row {
    animation: highlightPulse 2s ease-in-out infinite;
}

/* === Loading Indicator === */
.loading-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    color: #667eea;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #e9ecef;
    border-top-color: #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-text {
    font-size: 14px;
    font-weight: 600;
}

/* === Model Selector === */
.model-selector {
    background: #f8f9fa;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.model-selector label {
    margin-bottom: 10px;
}

.model-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.model-option {
    padding: 10px 20px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
}

.model-option:hover {
    border-color: #667eea;
}

.model-option.active {
    border-color: #667eea;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.model-status {
    margin-top: 10px;
    font-size: 12px;
    color: #6c757d;
}

.model-status.loaded {
    color: #28a745;
}

.model-status.loading {
    color: #ffc107;
}

.model-status.error {
    color: #dc3545;
}

.model-status.warning {
    color: #fd7e14;
}

/* Model option small text */
.model-option small {
    display: block;
    font-size: 11px;
    opacity: 0.8;
    margin-top: 2px;
}

.model-option.active small {
    opacity: 0.9;
}

/* Real model option */
.model-option.real-model {
    border-color: #28a745;
    position: relative;
}

.model-option.real-model::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #28a745, #20c997);
    border-radius: 4px 4px 0 0;
}

.model-option.real-model.active {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border-color: #28a745;
}

/* Loading status */
.model-loading-status {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
    padding: 10px 15px;
    background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
    border-radius: 6px;
    color: #495057;
    font-size: 14px;
}

.loading-spinner {
    width: 18px;
    height: 18px;
    border: 2px solid #667eea30;
    border-top-color: #667eea;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Real model badge */
.real-model-badge {
    background: linear-gradient(135deg, #28a74515 0%, #20c99715 100%);
    border: 1px solid #28a74540;
    border-radius: 6px;
    padding: 10px 15px;
    margin-bottom: 15px;
    font-size: 14px;
    color: #155724;
}

.real-model-badge strong {
    color: #28a745;
}

/* Disabled inputs */
input[type="number"]:disabled,
input[type="text"]:disabled {
    background: #e9ecef;
    color: #6c757d;
    cursor: not-allowed;
    border-color: #ced4da;
}

/* Head title with real weights indicator */
.head-title small {
    font-weight: normal;
    color: #28a745;
    font-size: 0.8em;
}

/* === Responsive === */
@media (max-width: 768px) {
    h1 { font-size: 1.8em; }
    
    .control-row {
        grid-template-columns: 1fr;
    }
    
    .tabs {
        flex-wrap: wrap;
    }
    
    .heads-parallel-view {
        gap: 8px;
    }
    
    .head-unit {
        min-width: 80px;
        padding: 10px;
    }
    
    .layer-content {
        flex-direction: column;
    }
    
    .matrix-shape-display {
        flex-direction: column;
        gap: 10px;
    }
    
    .sequence-controls {
        flex-direction: column;
        gap: 10px;
    }
}

/* === Attention Pattern Guide === */
.attention-pattern-guide {
    background: linear-gradient(135deg, #e7f3ff 0%, #f0e7ff 100%);
    border: 2px solid #667eea;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.attention-pattern-guide h4 {
    color: #667eea;
    margin-bottom: 10px;
    font-size: 1.1em;
}

.attention-pattern-guide p {
    color: #495057;
    margin-bottom: 15px;
    font-size: 0.95em;
}

.pattern-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
}

.pattern-item {
    background: white;
    padding: 12px 15px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.pattern-item strong {
    display: block;
    color: #333;
    margin-bottom: 4px;
    font-size: 0.9em;
}

.pattern-item small {
    color: #6c757d;
    font-size: 0.8em;
    line-height: 1.4;
}

/* === Head Pattern Badge === */
.head-pattern-badge {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 8px 12px;
    margin: 8px 0;
    font-size: 0.85em;
    color: #495057;
    text-align: center;
    font-weight: 500;
}

.head-pattern-badge::before {
    content: "Detected: ";
    color: #6c757d;
    font-weight: normal;
}

