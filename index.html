<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Head Self-Attention Visualizer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Multi-Head Self-Attention Visualizer</h1>
            <p class="subtitle">Understanding Transformer Attention from First Principles</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="inputText">Input Sequence (space-separated tokens):</label>
                <input type="text" id="inputText" value="The cat sat on the mat" placeholder="Enter your text...">
            </div>

            <div class="control-row">
                <div class="control-group">
                    <label for="embedDim">Embedding Dimension:</label>
                    <input type="number" id="embedDim" value="64" min="8" max="512" step="8">
                </div>

                <div class="control-group">
                    <label for="numHeads">Number of Heads:</label>
                    <input type="number" id="numHeads" value="4" min="1" max="8">
                </div>

                <div class="control-group">
                    <label for="temperature">Temperature (for attention):</label>
                    <input type="number" id="temperature" value="1.0" min="0.1" max="2.0" step="0.1">
                </div>
            </div>

            <div class="control-group" style="margin-top: 15px;">
                <button onclick="runAttention()">Compute Attention</button>
            </div>
        </div>

        <div class="content">
            <div class="section">
                <div class="section-title">Input Tokens</div>
                <div id="tokenDisplay" class="token-display"></div>
                <div class="info-box">
                    <strong>What's happening:</strong> Each token is converted to a dense vector representation (embedding) of dimension d_model.
                </div>
            </div>

            <div class="section">
                <div class="section-title">Architecture Overview</div>
                <div id="architectureInfo"></div>
            </div>

            <div class="section">
                <div class="section-title">Transformer Architecture: Where Multi-Head Attention Lives</div>
                <div class="transformer-architecture">
                    <div class="arch-title">ðŸ”® Transformer Encoder Block</div>
                    
                    <div class="arch-view-toggle">
                        <button class="arch-toggle-btn active" onclick="setArchView('encoder')">Encoder</button>
                        <button class="arch-toggle-btn" onclick="setArchView('decoder')">Decoder</button>
                        <button class="arch-toggle-btn" onclick="setArchView('full')">Full Model</button>
                    </div>

                    <div id="architectureView" class="transformer-stack">
                        <!-- Dynamic architecture visualization will be inserted here -->
                    </div>

                    <div class="mha-detail-container" id="mhaDetailView">
                        <div class="mha-detail-title">ðŸŽ¯ Multi-Head Attention: Parallel Processing</div>
                        
                        <div class="data-flow-viz">
                            <div class="flow-node">
                                <div class="flow-node-box input">Input X</div>
                                <div class="flow-dim" id="flowInputDim">[n Ã— d_model]</div>
                            </div>
                            <div class="flow-connector connection-pulse">â†’</div>
                            <div class="flow-node">
                                <div class="flow-node-box qkv-proj">Linear Projections</div>
                                <div class="flow-dim">W<sup>Q</sup>, W<sup>K</sup>, W<sup>V</sup></div>
                            </div>
                            <div class="flow-connector connection-pulse">â†’</div>
                            <div class="flow-node">
                                <div class="flow-node-box attention">Parallel Heads</div>
                                <div class="flow-dim" id="flowHeadsDim">[h Ã— n Ã— d_k]</div>
                            </div>
                            <div class="flow-connector connection-pulse">â†’</div>
                            <div class="flow-node">
                                <div class="flow-node-box output">Concat + W<sup>O</sup></div>
                                <div class="flow-dim" id="flowOutputDim">[n Ã— d_model]</div>
                            </div>
                        </div>

                        <div id="headsParallelView" class="heads-parallel-view">
                            <!-- Dynamic heads will be inserted here -->
                        </div>

                        <div id="concatViz" class="concat-bar"></div>
                        <div class="concat-label">Concatenated Head Outputs â†’ Output Projection W<sup>O</sup></div>

                        <div class="arch-stats" id="archStats">
                            <!-- Dynamic stats will be inserted here -->
                        </div>
                    </div>

                    <div class="arch-info-panel">
                        <h4>ðŸ’¡ How It Connects to the Visualization Above</h4>
                        <p id="archConnectionInfo">
                            Click on any attention head above to see its specific attention pattern in the "Individual Heads" tab. 
                            Each head learns different patterns - some focus on local context (adjacent words), 
                            others capture long-range dependencies or syntactic structures.
                        </p>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">Overview</button>
                <button class="tab" onclick="switchTab('sequence')">Step-by-Step Sequence</button>
                <button class="tab" onclick="switchTab('heads')">Individual Heads</button>
                <button class="tab" onclick="switchTab('mathematics')">Mathematics</button>
            </div>

            <div id="overview" class="tab-content active">
                <div class="section">
                    <div class="section-title">Combined Attention Pattern</div>
                    <div class="viz-card">
                        <h3>Average Attention Weights Across All Heads</h3>
                        <canvas id="combinedAttentionCanvas"></canvas>
                    </div>
                    <div class="info-box">
                        <strong>What's happening:</strong> This shows the average attention pattern across all heads. Each cell (i,j) shows how much token i attends to token j.
                    </div>
                </div>
            </div>

            <div id="sequence" class="tab-content">
                <div class="section">
                    <div class="section-title">Step-by-Step Computation Sequence</div>
                    
                    <div class="sequence-controls">
                        <button class="seq-btn" onclick="previousStep()">â—€ Previous</button>
                        <span id="stepIndicator" class="step-indicator">Step 1 of 9</span>
                        <button class="seq-btn" onclick="nextStep()">Next â–¶</button>
                        <button class="seq-btn-secondary" onclick="resetSequence()">Reset</button>
                    </div>

                    <div class="step-progress">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>

                    <div id="sequenceVisualization" class="sequence-visualization">
                        <!-- Dynamic content will be inserted here -->
                    </div>

                    <div class="step-navigator">
                        <div class="nav-grid" id="stepNavGrid">
                            <!-- Step navigation buttons will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="heads" class="tab-content">
                <div class="section">
                    <div class="section-title">Individual Head Attention Patterns</div>
                    <div id="headsContainer"></div>
                    <div class="info-box">
                        <strong>What's happening:</strong> Each head learns to attend to different aspects of the input. Some might focus on local patterns, others on long-range dependencies.
                    </div>
                </div>
            </div>

            <div id="mathematics" class="tab-content">
                <div class="section">
                    <div class="section-title">Step-by-Step Mathematical Breakdown</div>
                    <div id="mathBreakdown"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Deep Dive: Q, K, V Transformation</div>
                <div class="info-box">
                    <strong>Conceptual Understanding:</strong><br>
                    â€¢ <strong>Query (Q):</strong> "What am I looking for?" - Represents what each token wants to know<br>
                    â€¢ <strong>Key (K):</strong> "What information do I have?" - Represents what each token can offer<br>
                    â€¢ <strong>Value (V):</strong> "What is my content?" - The actual information to be retrieved
                </div>
                <div id="qkvVisualization"></div>
            </div>

            <div class="section">
                <div class="section-title">Interactive Attention Flow</div>
                <div id="attentionFlow"></div>
            </div>
        </div>
    </div>

    <!-- Load modules -->
    <script type="module" src="js/main.js"></script>

    <!-- Vercel Analytics (only loads in production) -->
    <script>
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
            var script = document.createElement('script');
            script.defer = true;
            script.src = 'https://cdn.vercel-insights.com/v1/script.js';
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
